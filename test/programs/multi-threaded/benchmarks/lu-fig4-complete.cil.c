/* Generated by CIL v. 1.3.7 */
/* print_CIL_Input is true */

extern  __attribute__((__nothrow__, __noreturn__)) void __assert_fail(char const   *__assertion ,
                                                                      char const   *__file ,
                                                                      unsigned int __line ,
                                                                      char const   *__function ) ;
int __START_ASYNC__  =    0;
int __COUNT__  =    0;
extern int ( /* missing proto */  puts)() ;
__inline int PBReadSync(int i ) ;
__inline int _PR_MD_GET_INTSOFF(void) ;
__inline void DoneWaitingOnThisThread(int thread ) ;


/* Thread 0 */
void thread0(int fd , int bytes , int op )
{ int refNum ;
  int err ;
  int pbAsync_pb ;
  int me_io_pending ;
  int doingAsync ;
  long __cil_tmp9 ;

  {
    if (refNum >= 0) {
      if (refNum < 3) {
        if (refNum == 0) {
          goto switch_0_0;
        } else {
          if (refNum == 1) {
            goto switch_0_1;
          } else {
            if (refNum == 2) {
              goto switch_0_1;
            } else {
              if (0) {
              switch_0_0: /* CIL Label */
                err = -1;
                goto PseudoErrorExit;
                goto switch_0_break;
              switch_0_1: /* CIL Label */
              switch_0_2: /* CIL Label */
                {
                  puts();
                }
                goto switch_0_break;
              } else {
              switch_0_break: /* CIL Label */ ;
              }
            }
          }
        }
        return;
      } else {
        goto _L;
      }
    } else {
    _L: /* CIL Label */
      doingAsync = 0;
      if (op == 1) {
        {
          __cil_tmp9 = (long )bytes;
          if (__cil_tmp9 > 20480L) {
            doingAsync = 1;
            __START_ASYNC__ = 1;
              _START_ATOMIC;
            if (__COUNT__ == 0) {
              me_io_pending = 1;
              __COUNT__ = __COUNT__ + 1;
            } else {
              {
                __assert_fail("0", "lu-fig4-complete-thr0.c", 60U, "main");
              }
            }
	    _END_ATOMIC;
          } else {
            {
              me_io_pending = 0;
              err = PBReadSync(pbAsync_pb);
            }
            if (err != 0) {
              if (err != -1) {
                goto PseudoErrorExit;
              } else {

              }
            } else {

            }
          }
        }
      } else {
        doingAsync = 1;
        me_io_pending = 1;
      }
      if (doingAsync) {

      } else {

      }
    }
    if (err != 0) {
      goto PseudoErrorExit;
    } else {

    }
    if (err != 0) {
      if (err != -1) {
        goto PseudoErrorExit;
      } else {

      }
    } else {

    }
    return;
  PseudoErrorExit:
    return;
  }
}
__inline int PBReadSync(int i )
{

  {
    return (0);
  }
}

/* Thread 1 */
void thread1(int pbAsyncPtr_thread )
{ int thread ;
  int tmp ;

  {
    {
      while (1) {
      while_0_continue: /* CIL Label */ ;
        if (__START_ASYNC__ == 0) {

        } else {
          goto while_0_break;
        }
      }
    while_0_break: /* CIL Label */ ;
    }
    {
      thread = pbAsyncPtr_thread;
      tmp = _PR_MD_GET_INTSOFF();
    }
    if (tmp) {
      return;
    } else {

    }
    {
      DoneWaitingOnThisThread(thread);
    }
    return;
  }
}
__inline void DoneWaitingOnThisThread(int thread )
{ int thread_io_pending ;

  {
    _START_ATOMIC;
    if (__COUNT__ == 1) {
      thread_io_pending = 0;
      __COUNT__ = __COUNT__ + 1;
    } else {
      {
        __assert_fail("0", "lu-fig4-complete-thr1.c", 39U, "DoneWaitingOnThisThread");
      }
    }
    _END_ATOMIC;
    return;
  }
}
__inline int _PR_MD_GET_INTSOFF(void)
{

  {
    return (0);
  }
}
