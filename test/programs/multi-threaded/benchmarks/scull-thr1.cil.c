/* Generated by CIL v. 1.3.7 */
/* print_CIL_Input is true */

#line 71 "/usr/include/assert.h"
extern  __attribute__((__nothrow__, __noreturn__)) void __assert_fail(char const   *__assertion ,
                                                                      char const   *__file ,
                                                                      unsigned int __line ,
                                                                      char const   *__function ) ;
#line 10 "scull-thr1.c"
int i  ;
#line 11 "scull-thr1.c"
int lock  =    0;
#line 12 "scull-thr1.c"
int __BLAST_NONDET  ;
#line 20
__inline int scull_open(int tid , int i___0 , int filp ) ;
#line 21
__inline int scull_read(int tid , int filp , int buf , int count , int f_pos ) ;
#line 15 "scull-thr1.c"
void main(void)
{ int filp ;
  int buf ;
  int count ;
  int off ;

  {
    {
#line 18
      count = 10;
#line 19
      off = 0;
#line 20
      scull_open(1, i, filp);
#line 21
      scull_read(1, filp, buf, count, off);
    }
#line 23
    return;
  }
}
#line 32 "scull-thr1.c"
__inline int down_interruptible(int tid )
{

  {
    {
#line 33
      while (1) {
      while_0_continue: /* CIL Label */ ;
#line 33
        if (lock != 0) {

        } else {
          goto while_0_break;
        }
      }
    while_0_break: /* CIL Label */ ;
    }
#line 33
    _START_NOENV;
    lock = tid;
    _END_NOENV;
#line 34
    return (0);
  }
}
#line 41 "scull-thr1.c"
__inline int copy_to_user(int to , int from , int n )
{

  {
#line 42
    to = from;
#line 43
    return (__BLAST_NONDET);
  }
}
#line 46 "scull-thr1.c"
__inline int copy_from_user(int to , int from , int n )
{

  {
#line 47
    to = from;
#line 48
    return (__BLAST_NONDET);
  }
}
#line 51 "scull-thr1.c"
__inline int __get_user(int size , int ptr )
{

  {
#line 53
    return (__BLAST_NONDET);
  }
}
#line 56 "scull-thr1.c"
__inline int __put_user(int size , int ptr )
{

  {
#line 58
    return (__BLAST_NONDET);
  }
}
#line 82 "scull-thr1.c"
int scull_quantum  =    4000;
#line 83 "scull-thr1.c"
int scull_qset  =    1000;
#line 84 "scull-thr1.c"
int dev_data  ;
#line 85 "scull-thr1.c"
int dev_quantum  ;
#line 86 "scull-thr1.c"
int dev_qset  ;
#line 87 "scull-thr1.c"
int dev_size  ;
#line 88 "scull-thr1.c"
int __X__  ;
#line 94 "scull-thr1.c"
int scull_trim(int dev )
{ int qset ;

  {
#line 96
    qset = dev_qset;
#line 98
    dev_size = 0;
#line 99
    dev_quantum = scull_quantum;
#line 100
    dev_qset = scull_qset;
#line 101
    dev_data = 0;
#line 102
    return (0);
  }
}
#line 110 "scull-thr1.c"
__inline int scull_open(int tid , int i___0 , int filp )
{ int dev ;
  int tmp ;

  {
    {
#line 114
      dev = i___0;
#line 115
      filp = dev;
#line 117
      tmp = down_interruptible(tid);
    }
#line 117
    if (tmp) {
#line 118
      return (-512);
    } else {

    }
    {
#line 120
      __X__ = 2;
#line 121
      scull_trim(dev);
    }
#line 122
    if (__X__ >= 2) {

    } else {
      {
#line 122
        __assert_fail("__X__ >= 2", "scull-thr1.c", 122U, "scull_open");
      }
    }
#line 123
    lock = 0;
#line 124
    return (0);
  }
}
#line 131 "scull-thr1.c"
__inline int scull_follow(int dev , int n )
{

  {
#line 132
    return (__BLAST_NONDET);
  }
}
#line 139 "scull-thr1.c"
__inline int scull_read(int tid , int filp , int buf , int count , int f_pos )
{ int dev ;
  int dptr ;
  int quantum ;
  int qset ;
  int itemsize ;
  int item ;
  int s_pos ;
  int q_pos ;
  int rest ;
  int retval ;
  int tmp ;
  int tmp___0 ;
  int __cil_tmp18 ;
  int __cil_tmp19 ;
  int __cil_tmp20 ;
  int __cil_tmp21 ;

  {
    {
#line 142
      dev = filp;
#line 144
      quantum = dev_quantum;
#line 144
      qset = dev_qset;
#line 145
      itemsize = quantum * qset;
#line 147
      retval = 0;
#line 149
      tmp = down_interruptible(tid);
    }
#line 149
    if (tmp) {
#line 150
      return (-512);
    } else {

    }
#line 152
    __X__ = 0;
#line 154
    if (f_pos >= dev_size) {
      goto out;
    } else {

    }
    {
#line 156
      __cil_tmp18 = f_pos + count;
#line 156
      if (__cil_tmp18 >= dev_size) {
#line 157
        count = dev_size - f_pos;
      } else {

      }
    }
    {
#line 160
      item = f_pos / itemsize;
#line 161
      rest = f_pos;
#line 162
      s_pos = rest / quantum;
#line 162
      q_pos = rest;
#line 165
      dptr = scull_follow(dev, item);
    }
    {
#line 168
      __cil_tmp19 = quantum - q_pos;
#line 168
      if (count > __cil_tmp19) {
#line 169
        count = quantum - q_pos;
      } else {

      }
    }
    {
#line 171
      __cil_tmp20 = dev_data + s_pos;
#line 171
      __cil_tmp21 = __cil_tmp20 + q_pos;
#line 171
      tmp___0 = copy_to_user(buf, __cil_tmp21, count);
    }
#line 171
    if (tmp___0) {
#line 172
      retval = -2;
      goto out;
    } else {

    }
#line 175
    f_pos = f_pos + count;
#line 176
    retval = count;
#line 178
    if (__X__ <= 0) {

    } else {
      {
#line 178
        __assert_fail("__X__ <= 0", "scull-thr1.c", 178U, "scull_read");
      }
    }
  out:
#line 181
    lock = 0;
#line 182
    return (retval);
  }
}
#line 185 "scull-thr1.c"
__inline int scull_write(int tid , int filp , int buf , int count , int f_pos )
{ int dev ;
  int dptr ;
  int quantum ;
  int qset ;
  int itemsize ;
  int item ;
  int s_pos ;
  int q_pos ;
  int rest ;
  int retval ;
  int tmp ;
  int tmp___0 ;
  int __cil_tmp18 ;
  int __cil_tmp19 ;
  int __cil_tmp20 ;

  {
    {
#line 188
      dev = filp;
#line 190
      quantum = dev_quantum;
#line 190
      qset = dev_qset;
#line 191
      itemsize = quantum * qset;
#line 193
      retval = -4;
#line 195
      tmp = down_interruptible(tid);
    }
#line 195
    if (tmp) {
#line 196
      return (-512);
    } else {

    }
    {
#line 199
      item = f_pos / itemsize;
#line 200
      rest = f_pos;
#line 201
      s_pos = rest / quantum;
#line 201
      q_pos = rest;
#line 204
      dptr = scull_follow(dev, item);
    }
#line 205
    if (dptr == 0) {
      goto out;
    } else {

    }
    {
#line 209
      __cil_tmp18 = quantum - q_pos;
#line 209
      if (count > __cil_tmp18) {
#line 210
        count = quantum - q_pos;
      } else {

      }
    }
    {
#line 212
      __X__ = 1;
#line 214
      __cil_tmp19 = dev_data + s_pos;
#line 214
      __cil_tmp20 = __cil_tmp19 + q_pos;
#line 214
      tmp___0 = copy_from_user(__cil_tmp20, buf, count);
    }
#line 214
    if (tmp___0) {
#line 215
      retval = -2;
      goto out;
    } else {

    }
#line 218
    f_pos = f_pos + count;
#line 219
    retval = count;
#line 222
    if (dev_size < f_pos) {
#line 223
      dev_size = f_pos;
    } else {

    }
#line 225
    if (__X__ == 1) {

    } else {
      {
#line 225
        __assert_fail("__X__ == 1", "scull-thr1.c", 225U, "scull_write");
      }
    }
  out:
#line 228
    lock = 0;
#line 229
    return (retval);
  }
}
#line 245 "scull-thr1.c"
__inline void scull_cleanup_module(void)
{ int dev ;

  {
    {
#line 248
      scull_trim(dev);
    }
#line 250
    return;
  }
}
#line 252 "scull-thr1.c"
__inline int scull_init_module(void)
{ int result ;

  {
#line 254
    result = 0;
#line 255
    return (0);
    {
#line 258
      scull_cleanup_module();
    }
#line 259
    return (result);
  }
}
