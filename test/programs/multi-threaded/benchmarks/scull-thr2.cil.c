/* Generated by CIL v. 1.3.7 */
/* print_CIL_Input is true */

#line 71 "/usr/include/assert.h"
extern  __attribute__((__nothrow__, __noreturn__)) void __assert_fail(char const   *__assertion ,
                                                                      char const   *__file ,
                                                                      unsigned int __line ,
                                                                      char const   *__function ) ;
#line 10 "scull-thr2.c"
int i  ;
#line 11 "scull-thr2.c"
int lock  =    0;
#line 12 "scull-thr2.c"
int __BLAST_NONDET  ;
#line 19
__inline int scull_open(int tid , int i___0 , int filp ) ;
#line 20
__inline int scull_write(int tid , int filp , int buf , int count , int f_pos ) ;
#line 14 "scull-thr2.c"
void main(void) 
{ int filp ;
  int buf ;
  int count ;
  int off ;

  {
  {
#line 17
  count = 10;
#line 18
  off = 0;
#line 19
  scull_open(2, i, filp);
#line 20
  scull_write(2, filp, buf, count, off);
  }
#line 22
  return;
}
}
#line 31 "scull-thr2.c"
__inline int down_interruptible(int tid ) 
{ 

  {
  {
#line 32
  while (1) {
    while_0_continue: /* CIL Label */ ;
#line 32
    if (lock != 0) {

    } else {
      goto while_0_break;
    }
  }
  while_0_break: /* CIL Label */ ;
  }
#line 32
  _START_NOENV;
  lock = tid;
  _END_NOENV;
#line 33
  return (0);
}
}
#line 40 "scull-thr2.c"
__inline int copy_to_user(int to , int from , int n ) 
{ 

  {
#line 41
  to = from;
#line 42
  return (__BLAST_NONDET);
}
}
#line 45 "scull-thr2.c"
__inline int copy_from_user(int to , int from , int n ) 
{ 

  {
#line 46
  to = from;
#line 47
  return (__BLAST_NONDET);
}
}
#line 50 "scull-thr2.c"
__inline int __get_user(int size , int ptr ) 
{ 

  {
#line 52
  return (__BLAST_NONDET);
}
}
#line 55 "scull-thr2.c"
__inline int __put_user(int size , int ptr ) 
{ 

  {
#line 57
  return (__BLAST_NONDET);
}
}
#line 81 "scull-thr2.c"
int scull_quantum  =    4000;
#line 82 "scull-thr2.c"
int scull_qset  =    1000;
#line 83 "scull-thr2.c"
int dev_data  ;
#line 84 "scull-thr2.c"
int dev_quantum  ;
#line 85 "scull-thr2.c"
int dev_qset  ;
#line 86 "scull-thr2.c"
int dev_size  ;
#line 87 "scull-thr2.c"
int __X__  ;
#line 93 "scull-thr2.c"
int scull_trim(int dev ) 
{ int qset ;

  {
#line 95
  qset = dev_qset;
#line 97
  dev_size = 0;
#line 98
  dev_quantum = scull_quantum;
#line 99
  dev_qset = scull_qset;
#line 100
  dev_data = 0;
#line 101
  return (0);
}
}
#line 109 "scull-thr2.c"
__inline int scull_open(int tid , int i___0 , int filp ) 
{ int dev ;
  int tmp ;

  {
  {
#line 113
  dev = i___0;
#line 114
  filp = dev;
#line 116
  tmp = down_interruptible(tid);
  }
#line 116
  if (tmp) {
#line 117
    return (-512);
  } else {

  }
  {
#line 119
  __X__ = 2;
#line 120
  scull_trim(dev);
  }
#line 121
  if (__X__ >= 2) {

  } else {
    {
#line 121
    __assert_fail("__X__ >= 2", "scull-thr2.c", 121U, "scull_open");
    }
  }
#line 122
  lock = 0;
#line 123
  return (0);
}
}
#line 130 "scull-thr2.c"
__inline int scull_follow(int dev , int n ) 
{ 

  {
#line 131
  return (__BLAST_NONDET);
}
}
#line 138 "scull-thr2.c"
__inline int scull_read(int tid , int filp , int buf , int count , int f_pos ) 
{ int dev ;
  int dptr ;
  int quantum ;
  int qset ;
  int itemsize ;
  int item ;
  int s_pos ;
  int q_pos ;
  int rest ;
  int retval ;
  int tmp ;
  int tmp___0 ;
  int __cil_tmp18 ;
  int __cil_tmp19 ;
  int __cil_tmp20 ;
  int __cil_tmp21 ;

  {
  {
#line 141
  dev = filp;
#line 143
  quantum = dev_quantum;
#line 143
  qset = dev_qset;
#line 144
  itemsize = quantum * qset;
#line 146
  retval = 0;
#line 148
  tmp = down_interruptible(tid);
  }
#line 148
  if (tmp) {
#line 149
    return (-512);
  } else {

  }
#line 151
  __X__ = 0;
#line 153
  if (f_pos >= dev_size) {
    goto out;
  } else {

  }
  {
#line 155
  __cil_tmp18 = f_pos + count;
#line 155
  if (__cil_tmp18 >= dev_size) {
#line 156
    count = dev_size - f_pos;
  } else {

  }
  }
  {
#line 159
  item = f_pos / itemsize;
#line 160
  rest = f_pos;
#line 161
  s_pos = rest / quantum;
#line 161
  q_pos = rest;
#line 164
  dptr = scull_follow(dev, item);
  }
  {
#line 167
  __cil_tmp19 = quantum - q_pos;
#line 167
  if (count > __cil_tmp19) {
#line 168
    count = quantum - q_pos;
  } else {

  }
  }
  {
#line 170
  __cil_tmp20 = dev_data + s_pos;
#line 170
  __cil_tmp21 = __cil_tmp20 + q_pos;
#line 170
  tmp___0 = copy_to_user(buf, __cil_tmp21, count);
  }
#line 170
  if (tmp___0) {
#line 171
    retval = -2;
    goto out;
  } else {

  }
#line 174
  f_pos = f_pos + count;
#line 175
  retval = count;
#line 177
  if (__X__ <= 0) {

  } else {
    {
#line 177
    __assert_fail("__X__ <= 0", "scull-thr2.c", 177U, "scull_read");
    }
  }
  out: 
#line 180
  lock = 0;
#line 181
  return (retval);
}
}
#line 184 "scull-thr2.c"
__inline int scull_write(int tid , int filp , int buf , int count , int f_pos ) 
{ int dev ;
  int dptr ;
  int quantum ;
  int qset ;
  int itemsize ;
  int item ;
  int s_pos ;
  int q_pos ;
  int rest ;
  int retval ;
  int tmp ;
  int tmp___0 ;
  int __cil_tmp18 ;
  int __cil_tmp19 ;
  int __cil_tmp20 ;

  {
  {
#line 187
  dev = filp;
#line 189
  quantum = dev_quantum;
#line 189
  qset = dev_qset;
#line 190
  itemsize = quantum * qset;
#line 192
  retval = -4;
#line 194
  tmp = down_interruptible(tid);
  }
#line 194
  if (tmp) {
#line 195
    return (-512);
  } else {

  }
  {
#line 198
  item = f_pos / itemsize;
#line 199
  rest = f_pos;
#line 200
  s_pos = rest / quantum;
#line 200
  q_pos = rest;
#line 203
  dptr = scull_follow(dev, item);
  }
#line 204
  if (dptr == 0) {
    goto out;
  } else {

  }
  {
#line 208
  __cil_tmp18 = quantum - q_pos;
#line 208
  if (count > __cil_tmp18) {
#line 209
    count = quantum - q_pos;
  } else {

  }
  }
  {
#line 211
  __X__ = 1;
#line 213
  __cil_tmp19 = dev_data + s_pos;
#line 213
  __cil_tmp20 = __cil_tmp19 + q_pos;
#line 213
  tmp___0 = copy_from_user(__cil_tmp20, buf, count);
  }
#line 213
  if (tmp___0) {
#line 214
    retval = -2;
    goto out;
  } else {

  }
#line 217
  f_pos = f_pos + count;
#line 218
  retval = count;
#line 221
  if (dev_size < f_pos) {
#line 222
    dev_size = f_pos;
  } else {

  }
#line 224
  if (__X__ == 1) {

  } else {
    {
#line 224
    __assert_fail("__X__ == 1", "scull-thr2.c", 224U, "scull_write");
    }
  }
  out: 
#line 227
  lock = 0;
#line 228
  return (retval);
}
}
#line 244 "scull-thr2.c"
__inline void scull_cleanup_module(void) 
{ int dev ;

  {
  {
#line 247
  scull_trim(dev);
  }
#line 249
  return;
}
}
#line 251 "scull-thr2.c"
__inline int scull_init_module(void) 
{ int result ;

  {
#line 253
  result = 0;
#line 254
  return (0);
  {
#line 257
  scull_cleanup_module();
  }
#line 258
  return (result);
}
}
