# This file is part of CPAchecker,
# a tool for configurable software verification:
# https://cpachecker.sosy-lab.org
#
# SPDX-FileCopyrightText: 2007-2020 Dirk Beyer <https://www.sosy-lab.org>
#
# SPDX-License-Identifier: Apache-2.0

# This file contains only some global CI config.
# Most jobs are included here:
include:
  - local: build/gitlab-ci.local.yml
    rules:
      - if: $AUTO_UPDATE_DEPENDENCIES != "true"

# Run either MR pipelines or regular pipelines, but never both at the same time.
# Cf. https://docs.gitlab.com/ee/ci/yaml/workflow.html#switch-between-branch-pipelines-and-merge-request-pipelines
workflow:
  rules:
    - if: $CI_COMMIT_BRANCH && $CI_OPEN_MERGE_REQUESTS && $CI_PIPELINE_SOURCE == "push"
      when: never
    - when: always

variables:
  PROJECT_PATH: "sosy-lab/software/cpachecker"
  # Version of https://gitlab.com/sosy-lab/software/refaster/ to use
  REFASTER_REPO_REVISION: d0df2ab5b02285f95bef9d3c6263f2ecdb3752ad
  # Needs to be synchronized with Error Prone version in lib/ivy.xml
  REFASTER_VERSION: 2.43.0

auto-update-dependencies:
  stage: deploy
  image: ${CI_REGISTRY_IMAGE}/test:jdk-21
  script:
    - build/auto-update-dependencies.sh
  environment: repo/auto-update-dependencies
  rules:
    - if: $AUTO_UPDATE_DEPENDENCIES == "true"
  cache:
    key: "$CI_JOB_NAME"
    paths:
      - ".ivy2/"
