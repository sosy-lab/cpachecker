// SPDX-FileCopyrightText: The Linux kernel authors
//
// SPDX-License-Identifier: GPL-2.0-only

/* Generated by CIL v. 1.3.7 */
/* print_CIL_Input is true */

#line 211 "/usr/lib/gcc/i486-linux-gnu/4.4.3/include/stddef.h"
typedef unsigned int size_t;
#line 15 "infiniband_mad_simple.c"
struct ib_pd {
   int field ;
};
#line 19 "infiniband_mad_simple.c"
struct ib_mr {
   int device ;
   struct ib_pd *pd ;
};
#line 24 "infiniband_mad_simple.c"
struct ib_mad_agent {
   struct ib_mr *mr ;
};
#line 28 "infiniband_mad_simple.c"
struct ib_mad_agent_private {
   struct ib_mad_agent agent ;
   unsigned long timeout ;
};
#line 28 "infiniband_mad_simple.c"
typedef struct ib_mad_agent_private ib_mad_agent_private;
#line 33 "infiniband_mad_simple.c"
struct ib_mad_reg_req {
   int a ;
};
#line 471 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) void *malloc(size_t __size )  __attribute__((__malloc__)) ;
#line 488
extern  __attribute__((__nothrow__)) void free(void *__ptr ) ;
#line 37 "infiniband_mad_simple.c"
void kfree(void *objp ) 
{ 

  {
  {
#line 38
  free(objp);
  }
#line 39
  return;
}
}
#line 41 "infiniband_mad_simple.c"
void *kmalloc(size_t size ) 
{ void *tmp ;

  {
  {
#line 42
  tmp = malloc(size);
  }
#line 42
  return (tmp);
}
}
#line 46 "infiniband_mad_simple.c"
int ib_dereg_mr(struct ib_mr *mr ) 
{ struct ib_pd *pd ;
  int ret ;
  unsigned int __cil_tmp4 ;
  unsigned int __cil_tmp5 ;
  struct ib_pd **mem_6 ;

  {
#line 49
  ret = 0;
#line 51
  __cil_tmp4 = (unsigned int )mr;
#line 51
  __cil_tmp5 = __cil_tmp4 + 4;
#line 51
  mem_6 = (struct ib_pd **)__cil_tmp5;
#line 51
  pd = *mem_6;
#line 53
  return (ret);
}
}
#line 56 "infiniband_mad_simple.c"
struct ib_mad_agent *ib_register_mad_agent(struct ib_mad_reg_req *mad_reg_req ) 
{ int ret ;
  ib_mad_agent_private *mad_agent_priv ;
  struct ib_mad_reg_req *reg_req ;
  void *tmp ;
  void *tmp___0 ;
  void *__cil_tmp7 ;
  void *__cil_tmp8 ;
  struct ib_mr *__cil_tmp9 ;
  struct ib_mr **mem_10 ;

  {
  {
#line 58
  ret = 0;
#line 60
  __cil_tmp7 = (void *)0;
#line 60
  reg_req = (struct ib_mad_reg_req *)__cil_tmp7;
#line 62
  tmp = kmalloc(8U);
#line 62
  mad_agent_priv = (ib_mad_agent_private *)tmp;
  }
#line 63
  if (! mad_agent_priv) {
#line 64
    ret = -12;
    goto err1;
  } else {

  }
#line 68
  if (mad_reg_req) {
    {
#line 69
    tmp___0 = kmalloc(4U);
#line 69
    reg_req = (struct ib_mad_reg_req *)tmp___0;
    }
#line 70
    if (! reg_req) {
#line 71
      ret = -12;
      goto err3;
    } else {

    }
  } else {

  }
#line 76
  return ((struct ib_mad_agent *)mad_agent_priv);
  err3: 
  {
#line 79
  __cil_tmp8 = (void *)mad_agent_priv;
#line 79
  kfree(__cil_tmp8);
  }
  {
#line 81
  mem_10 = (struct ib_mr **)mad_agent_priv;
#line 81
  __cil_tmp9 = *mem_10;
#line 81
  ib_dereg_mr(__cil_tmp9);
  }
  err1: 
#line 83
  return ((struct ib_mad_agent *)ret);
}
}
#line 87 "infiniband_mad_simple.c"
int main(void) 
{ struct ib_mad_reg_req *reg_req ;
  void *tmp ;
  void *__cil_tmp3 ;

  {
  {
#line 88
  __cil_tmp3 = (void *)0;
#line 88
  reg_req = (struct ib_mad_reg_req *)__cil_tmp3;
#line 89
  tmp = kmalloc(4U);
#line 89
  reg_req = (struct ib_mad_reg_req *)tmp;
#line 91
  ib_register_mad_agent(reg_req);
  }
#line 93
  return (0);
}
}
